<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒç±»é¡¹è¿è¿çœ‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background-color: #f9f9f9;
            font-family: "Microsoft YaHei", sans-serif;
            padding: 20px 0;
        }
        .container {
            width: 90vw;
            max-width: 650px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 25px;
        }
        h1 {
            text-align: center;
            color: #7b68ee;
            margin-bottom: 5px;
            font-size: clamp(1.6rem, 4vw, 2.2rem);
        }
        .author {
            text-align: center;
            color: #696969;
            font-size: 1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        /* é¡¶éƒ¨åŠŸèƒ½åŒº */
        .top-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 18px;
        }
        /* å§“åè¾“å…¥åŒº */
        .name-area {
            text-align: center;
        }
        .name-input {
            padding: 9px 15px;
            border: 2px solid #7b68ee;
            border-radius: 8px;
            width: 65%;
            max-width: 220px;
            font-size: 1rem;
            outline: none;
            transition: border 0.2s;
        }
        .name-input:focus {
            border-color: #9370db;
        }
        /* æŒ‰é’®ç»„ - æ˜äº®é©¬å¡é¾™è‰² */
        .btn-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 9px 18px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.25s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #startBtn {
            background-color: #98fb98;
            color: #2e8b57;
            font-weight: bold;
        }
        #startBtn:hover {
            background-color: #7cfc7c;
            box-shadow: 0 3px 8px rgba(152, 251, 152, 0.4);
        }
        #resetBtn {
            background-color: #ffb6c1;
            color: #c71585;
        }
        #resetBtn:hover {
            background-color: #ffc0cb;
            box-shadow: 0 3px 8px rgba(255, 182, 193, 0.4);
        }
        #clearRecordBtn {
            background-color: #87ceeb;
            color: #4682b4;
        }
        #clearRecordBtn:hover {
            background-color: #87cefa;
            box-shadow: 0 3px 8px rgba(135, 206, 235, 0.4);
        }
        .control-btn:disabled {
            background-color: #e0e0e0;
            color: #9e9e9e;
            cursor: not-allowed;
            box-shadow: none;
        }
        /* ç”¨æ—¶è¡¨æ ¼ */
        .time-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px auto;
            text-align: center;
        }
        .time-table th, .time-table td {
            border: 2px solid #7b68ee;
            padding: 8px;
            font-size: 0.95rem;
        }
        .time-table th {
            background-color: #f0e6fa;
            color: #7b68ee;
        }
        /* æ¸¸æˆè¯´æ˜ */
        .game-intro {
            text-align: center;
            color: #696969;
            margin-bottom: 18px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        /* ä¸€è¡Œä¸‰åˆ—å¡ç‰‡ç½‘æ ¼ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            justify-items: center;
            margin-bottom: 22px;
        }
        /* æ˜äº®é©¬å¡é¾™è‰²å¡ç‰‡ + ç‚¹å‡»éœ‡åŠ¨ */
        .algebra-card {
            width: 100%;
            max-width: 110px;
            height: 55px;
            background-color: #f0e68c;
            border: 2px solid #bdb76b;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            color: #808000;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }
        .algebra-card:hover {
            transform: scale(1.06);
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
        }
        .algebra-card.active {
            background-color: #ffdab9;
            border-color: #cd853f;
            color: #8b4513;
        }
        .algebra-card.matched {
            opacity: 0;
            visibility: hidden;
            transform: scale(0);
            transition: all 0.3s ease-out;
            pointer-events: none;
        }
        /* éœ‡åŠ¨åŠ¨ç”» */
        @keyframes vibrate {
            0% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            50% { transform: translateX(0); }
            75% { transform: translateX(2px); }
            100% { transform: translateX(0); }
        }
        .vibrate {
            animation: vibrate 0.2s ease;
        }
        /* ç»“æœæç¤º */
        .result-tip {
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 10px;
            color: #7b68ee;
            min-height: 26px;
        }
        /* é€šå…³å¼¹çª— */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        .modal-content {
            background-color: #fff;
            padding: 30px 40px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .modal h2 {
            color: #7b68ee;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        .modal p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #333;
        }
        .modal-btn {
            padding: 10px 25px;
            background-color: #98fb98;
            color: #2e8b57;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-btn:hover {
            background-color: #7cfc7c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åŒç±»é¡¹è¿è¿çœ‹</h1>
        <div class="author">ä½œè€…ï¼šæå¨ŸèŒ¹</div>
        <div class="top-area">
            <!-- å§“åè¾“å…¥ -->
            <div class="name-area">
                <input type="text" class="name-input" id="nameInput" placeholder="è¯·è¾“å…¥å§“å">
            </div>

            <!-- æŒ‰é’®ç»„ -->
            <div class="btn-group">
                <button class="control-btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                <button class="control-btn" id="resetBtn" disabled>é‡æ–°å¼€å§‹</button>
                <button class="control-btn" id="clearRecordBtn">æ¸…ç©ºçºªå½•</button>
            </div>

            <!-- ç”¨æ—¶ç»Ÿè®¡è¡¨æ ¼ -->
            <table class="time-table">
                <thead>
                    <tr>
                        <th>ç©å®¶å§“å</th>
                        <th>æœ¬æ¬¡ç”¨æ—¶</th>
                        <th>æœ€å¿«ç”¨æ—¶</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="playerNameTd">æœªå¼€å§‹</td>
                        <td id="currentTimeTd">--:--</td>
                        <td id="bestTimeTd">--:--</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æ¸¸æˆè¯´æ˜ -->
        <div class="game-intro">
            è§„åˆ™ï¼šè¾“å…¥å§“åç‚¹å‡»å¼€å§‹ â†’ é…å¯¹åŒç±»é¡¹å¡ç‰‡æ¶ˆé™¤ â†’ å…¨éƒ¨æ¶ˆé™¤å³ä¸ºé€šå…³ï¼<br>
            åŒç±»é¡¹å®šä¹‰ï¼šæ‰€å«å­—æ¯ç›¸åŒï¼Œå¹¶ä¸”ç›¸åŒå­—æ¯çš„æŒ‡æ•°ä¹Ÿç›¸åŒçš„é¡¹
        </div>

        <!-- å¡ç‰‡ç½‘æ ¼ -->
        <div class="card-grid" id="cardGrid"></div>

        <!-- ç»“æœæç¤º -->
        <div class="result-tip" id="resultTip"></div>
    </div>

    <!-- é€šå…³å¼¹çª— -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <h2>ğŸ‰ é€šå…³æˆåŠŸï¼ ğŸ‰</h2>
            <p id="modalText">æ­å–œä½ å®ŒæˆæŒ‘æˆ˜ï¼</p>
            <button class="modal-btn" id="modalCloseBtn">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // åŒç±»é¡¹é¢˜åº“ï¼ˆ10å¯¹å¤‡é€‰ï¼Œæ¯æ¬¡éšæœºé€‰6å¯¹ï¼‰
        const algebraPool = [
            { text: "3x", type: "x" }, { text: "-5x", type: "x" },
            { text: "2xÂ²", type: "x2" }, { text: "xÂ²", type: "x2" },
            { text: "4xy", type: "xy" }, { text: "-xy", type: "xy" },
            { text: "6", type: "constant" }, { text: "-2", type: "constant" },
            { text: "0.5xÂ³", type: "x3" }, { text: "3xÂ³", type: "x3" },
            { text: "7y", type: "y" }, { text: "-4y", type: "y" },
            { text: "8xÂ²y", type: "x2y" }, { text: "-2xÂ²y", type: "x2y" },
            { text: "5yÂ²", type: "y2" }, { text: "yÂ²", type: "y2" },
            { text: "9xyz", type: "xyz" }, { text: "-3xyz", type: "xyz" },
            { text: "4a", type: "a" }, { text: "-a", type: "a" }
        ];
        const totalPairs = 6; // æ”¹ä¸º6å¯¹
        let timerInterval = null;
        let startTime = 0;
        let selectedCards = [];
        let matchedPairs = 0;
        let isProcessing = false;
        let bestRecord = {name: "", time: "--:--"};
        let lastCardTypeStr = ""; // è®°å½•ä¸Šä¸€æ¬¡é€‰ä¸­çš„åŒç±»é¡¹ç±»å‹

        // DOMå…ƒç´ 
        const cardGrid = document.getElementById("cardGrid");
        const startBtn = document.getElementById("startBtn");
        const resetBtn = document.getElementById("resetBtn");
        const clearRecordBtn = document.getElementById("clearRecordBtn");
        const nameInput = document.getElementById("nameInput");
        const resultTip = document.getElementById("resultTip");
        const playerNameTd = document.getElementById("playerNameTd");
        const currentTimeTd = document.getElementById("currentTimeTd");
        const bestTimeTd = document.getElementById("bestTimeTd");
        const successModal = document.getElementById("successModal");
        const modalText = document.getElementById("modalText");
        const modalCloseBtn = document.getElementById("modalCloseBtn");

        // éšæœºé€‰å–6å¯¹ä¸é‡å¤çš„åŒç±»é¡¹ï¼Œä¸”ä¸ä¸Šä¸€æ¬¡ç»„åˆä¸åŒ
        function getRandom6Pairs() {
            // æ‰“ä¹±é¢˜åº“é¡ºåº
            const shuffledPool = [...algebraPool].sort(() => Math.random() - 0.5);
            // æå–æ‰€æœ‰åŒç±»é¡¹ç±»å‹
            const allTypes = [...new Set(shuffledPool.map(item => item.type))];
            // éšæœºé€‰6ä¸ªç±»å‹
            const selectedTypes = [];
            while (selectedTypes.length < totalPairs) {
                const randomType = allTypes[Math.floor(Math.random() * allTypes.length)];
                if (!selectedTypes.includes(randomType)) {
                    selectedTypes.push(randomType);
                }
            }
            // ç”Ÿæˆæœ¬æ¬¡çš„ç±»å‹å­—ç¬¦ä¸²ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
            const currentTypeStr = selectedTypes.sort().join(",");
            // å¦‚æœå’Œä¸Šä¸€æ¬¡ç±»å‹ç»„åˆç›¸åŒï¼Œé‡æ–°ç”Ÿæˆ
            if (currentTypeStr === lastCardTypeStr && lastCardTypeStr !== "") {
                return getRandom6Pairs();
            }
            lastCardTypeStr = currentTypeStr;
            // æå–å¯¹åº”ç±»å‹çš„å¡ç‰‡å¹¶æ‰“ä¹±é¡ºåº
            let selectedCards = [];
            selectedTypes.forEach(type => {
                const pair = shuffledPool.filter(item => item.type === type);
                selectedCards.push(...pair);
            });
            return selectedCards.sort(() => Math.random() - 0.5);
        }

        // åˆå§‹åŒ– - å¡ç‰‡ç½‘æ ¼é»˜è®¤æ¸…ç©º
        function initGame() {
            cardGrid.innerHTML = "";
            resultTip.textContent = "";
            currentTimeTd.textContent = "--:--";
            selectedCards = [];
            matchedPairs = 0;
            isProcessing = false;
            clearInterval(timerInterval);
            playerNameTd.textContent = nameInput.value.trim() || "åŒ¿åç©å®¶";

            // ç”Ÿæˆ6å¯¹éšæœºä¸é‡å¤å¡ç‰‡
            const shuffledCards = getRandom6Pairs();
            shuffledCards.forEach(item => {
                const card = document.createElement("div");
                card.className = "algebra-card";
                card.textContent = item.text;
                card.dataset.type = item.type;
                card.onclick = function() { 
                    this.classList.add("vibrate");
                    setTimeout(() => this.classList.remove("vibrate"), 200);
                    selectCard(this); 
                };
                cardGrid.appendChild(card);
            });
        }

        // å¡ç‰‡é€‰æ‹©é€»è¾‘
        function selectCard(card) {
            if (isProcessing || card.classList.contains("matched") || card.classList.contains("active")) return;
            if (selectedCards.length >= 2) return;

            card.classList.add("active");
            selectedCards.push(card);

            if (selectedCards.length === 2) {
                isProcessing = true;
                const card1 = selectedCards[0];
                const card2 = selectedCards[1];

                if (card1.dataset.type === card2.dataset.type) {
                    setTimeout(() => {
                        card1.classList.add("matched");
                        card2.classList.add("matched");
                        matchedPairs++;
                        selectedCards = [];
                        isProcessing = false;

                        if (matchedPairs === totalPairs) {
                            clearInterval(timerInterval);
                            const currentTime = currentTimeTd.textContent;
                            const userName = playerNameTd.textContent;
                            modalText.textContent = `${userName}ï¼Œæœ¬æ¬¡ç”¨æ—¶ ${currentTime}ï¼`;
                            successModal.style.display = "flex";
                            resetBtn.disabled = false;
                            updateBestRecord(userName, currentTime);
                        }
                    }, 300);
                } else {
                    setTimeout(() => {
                        card1.classList.remove("active");
                        card2.classList.remove("active");
                        selectedCards = [];
                        isProcessing = false;
                    }, 500);
                }
            }
        }

        // è®¡æ—¶å‡½æ•°
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                currentTimeTd.textContent = timeStr;
            }, 1000);
        }

        // æ›´æ–°æœ€å¿«çºªå½•
        function updateBestRecord(name, time) {
            if (bestRecord.time === "--:--") {
                bestRecord = {name, time};
                bestTimeTd.textContent = time;
                return;
            }
            const currentSec = timeToSeconds(time);
            const bestSec = timeToSeconds(bestRecord.time);
            if (currentSec < bestSec) {
                bestRecord = {name, time};
                bestTimeTd.textContent = time;
            }
        }

        // æ¸…ç©ºçºªå½•
        function clearBestRecord() {
            bestRecord = {name: "", time: "--:--"};
            bestTimeTd.textContent = "--:--";
            resultTip.textContent = "çºªå½•å·²æ¸…ç©ºï¼";
            setTimeout(() => resultTip.textContent = "", 2000);
        }

        // æ—¶é—´è½¬ç§’æ•°
        function timeToSeconds(timeStr) {
            const [min, sec] = timeStr.split(":").map(Number);
            return min * 60 + sec;
        }

        // å¼¹çª—å…³é—­äº‹ä»¶
        modalCloseBtn.onclick = function() {
            successModal.style.display = "none";
        }

        // æŒ‰é’®äº‹ä»¶ç»‘å®š - ä¿®å¤ç‚¹å‡»æ— ååº”é—®é¢˜
        startBtn.addEventListener('click', function() {
            const userName = nameInput.value.trim();
            if (!userName) {
                resultTip.textContent = "è¯·å…ˆè¾“å…¥å§“åï¼";
                return;
            }
            resultTip.textContent = "";
            initGame();
            startTimer();
            startBtn.disabled = true;
            resetBtn.disabled = true;
        });

        resetBtn.addEventListener('click', function() {
            initGame();
            startTimer();
            startBtn.disabled = true;
            resetBtn.disabled = true;
        });

        clearRecordBtn.addEventListener('click', clearBestRecord);

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            cardGrid.innerHTML = "";
            bestTimeTd.textContent = "--:--";
        };
    </script>
</body>
</html>
