<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>有理数相反数消消乐</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-sky-50 font-sans p-5">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6">
        <h1 class="text-3xl font-bold text-center text-slate-800 mb-2">有理数相反数消消乐</h1>
        <p class="text-center text-slate-600 mb-6">找出<span class="text-red-500 font-bold">互为相反数</span>的卡片，<span class="text-green-600 font-bold">时间越短得分越高</span>！</p>
        
        <!-- 学生姓名输入区域 -->
        <div id="loginSection" class="text-center mb-6">
            <input type="text" id="studentName" placeholder="请输入你的姓名" 
                   class="px-4 py-2 border border-slate-300 rounded-lg text-lg w-64 mb-4">
            <button id="startBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-lg font-semibold">开始游戏</button>
        </div>
        
        <!-- 游戏区域（初始隐藏） -->
        <div id="gameArea" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <div class="text-xl font-semibold text-slate-700">
                    玩家：<span id="playerName" class="text-blue-600"></span> | 
                    得分：<span id="score" class="text-red-500">0</span> | 
                    用时：<span id="timer" class="text-green-600">00:00</span>
                </div>
                <div class="flex gap-3">
                    <button id="easyBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">简单（8张）</button>
                    <button id="hardBtn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">困难（12张）</button>
                    <button id="resetBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">重新开始</button>
                </div>
            </div>
            
            <div id="gameBoard" class="grid grid-cols-4 gap-4 mb-6"></div>
            
            <div class="bg-blue-50 p-4 rounded-lg text-slate-700">
                <h3 class="font-bold mb-2">游戏规则：</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li>点击两张卡片，若两数之和为0（互为相反数）则消除（如 5 和 -5、-1/2 和 1/2）</li>
                    <li>基础得分：每次消除得10分；时间奖励：耗时≤30秒奖50分，30-60秒奖30分，60-90秒奖10分，＞90秒无奖励</li>
                    <li>最终得分=基础得分+时间奖励，全部消除后显示总得分</li>
                    <li>0的相反数是0，因此两张0卡片可相互消除</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 游戏核心数据
        let cardPairs = [];
        let selectedCards = [];
        let score = 0;
        let isProcessing = false;
        let studentName = '';
        let timerInterval = null;
        let totalSeconds = 0;

        // 生成仅含相反数对的有理数
        function generateNumbers(count) {
            const numbers = [];
            const oppositePairs = [
                { positive: 3, negative: -3 },
                { positive: 2, negative: -2 },
                { positive: 1, negative: -1 },
                { positive: 4, negative: -4 },
                { positive: 5, negative: -5 },
                { positive: 1/2, negative: -1/2 },
                { positive: 1/3, negative: -1/3 },
                { positive: 1/4, negative: -1/4 },
                { positive: 0, negative: 0 }
            ];
            const selectedPairs = [...oppositePairs].sort(() => 0.5 - Math.random()).slice(0, count / 2);
            selectedPairs.forEach(pair => {
                numbers.push({ value: pair.positive, display: formatNumber(pair.positive) });
                numbers.push({ value: pair.negative, display: formatNumber(pair.negative) });
            });
            return numbers.sort(() => 0.5 - Math.random());
        }

        // 格式化数字显示
        function formatNumber(num) {
            if (num === 1/2) return "1/2";
            if (num === -1/2) return "-1/2";
            if (num === 1/3) return "1/3";
            if (num === -1/3) return "-1/3";
            if (num === 1/4) return "1/4";
            if (num === -1/4) return "-1/4";
            return num.toString();
        }

        // 检查是否互为相反数
        function isMatch(card1, card2) {
            return card1.value + card2.value === 0;
        }

        // 创建游戏卡片
        function createGameBoard(count) {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            cardPairs = generateNumbers(count);

            cardPairs.forEach((card, index) => {
                const cardElement = document.createElement('div');
                // 关键样式：添加高度+透明度过渡，确保消失动画流畅
                cardElement.className = 'bg-blue-100 rounded-lg p-6 text-2xl font-bold text-center cursor-pointer hover:bg-blue-200 transition-all duration-500 transform hover:scale-105';
                cardElement.dataset.index = index;
                cardElement.textContent = card.display;
                cardElement.addEventListener('click', () => selectCard(cardElement, card));
                gameBoard.appendChild(cardElement);
            });
        }

        // 开始计时
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            totalSeconds = 0;
            timerInterval = setInterval(() => {
                totalSeconds++;
                const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                const seconds = (totalSeconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').textContent = `${minutes}:${seconds}`;
            }, 1000);
        }

        // 停止计时并计算时间奖励
        function stopTimer() {
            clearInterval(timerInterval);
            let timeReward = 0;
            if (totalSeconds <= 30) timeReward = 50;
            else if (totalSeconds <= 60) timeReward = 30;
            else if (totalSeconds <= 90) timeReward = 10;
            return timeReward;
        }

        // 选择卡片逻辑
        function selectCard(cardElement, card) {
            if (isProcessing || selectedCards.includes(cardElement) || cardElement.classList.contains('matched')) {
                return;
            }

            // 选中效果
            cardElement.classList.remove('bg-blue-100', 'hover:bg-blue-200');
            cardElement.classList.add('bg-yellow-300');
            selectedCards.push(cardElement);

            if (selectedCards.length === 2) {
                isProcessing = true;
                const [cardA, cardB] = selectedCards;
                const cardAData = cardPairs[cardA.dataset.index];
                const cardBData = cardPairs[cardB.dataset.index];

                if (isMatch(cardAData, cardBData)) {
                    // 匹配成功：卡片完全消失（透明度0+高度0）
                    setTimeout(() => {
                        cardA.classList.add('matched');
                        cardB.classList.add('matched');
                        // 核心消失样式：透明度→0，高度→0，padding→0，消除占位
                        cardA.style.opacity = '0';
                        cardA.style.height = '0';
                        cardA.style.padding = '0';
                        cardA.style.margin = '0';
                        cardA.style.border = 'none';
                        
                        cardB.style.opacity = '0';
                        cardB.style.height = '0';
                        cardB.style.padding = '0';
                        cardB.style.margin = '0';
                        cardB.style.border = 'none';
                        
                        // 禁止再次点击
                        cardA.style.pointerEvents = 'none';
                        cardB.style.pointerEvents = 'none';
                        
                        // 加分并更新显示
                        score += 10;
                        document.getElementById('score').textContent = score;
                        
                        selectedCards = [];
                        isProcessing = false;

                        // 全部消除：计算总得分
                        if (document.querySelectorAll('.matched').length === cardPairs.length) {
                            const timeReward = stopTimer();
                            const finalScore = score + timeReward;
                            document.getElementById('score').textContent = finalScore;
                            setTimeout(() => {
                                alert(`恭喜 ${studentName} 获胜！\n基础得分：${score}分\n时间奖励：${timeReward}分\n最终得分：${finalScore}分\n总用时：${document.getElementById('timer').textContent}`);
                            }, 500);
                        }
                    }, 500);
                } else {
                    // 匹配失败：恢复原状
                    setTimeout(() => {
                        cardA.classList.remove('bg-yellow-300');
                        cardB.classList.remove('bg-yellow-300');
                        cardA.classList.add('bg-blue-100', 'hover:bg-blue-200');
                        cardB.classList.add('bg-blue-100', 'hover:bg-blue-200');
                        
                        selectedCards = [];
                        isProcessing = false;
                    }, 800);
                }
            }
        }

        // 初始化游戏
        function initGame(difficulty) {
            score = 0;
            selectedCards = [];
            document.getElementById('score').textContent = score;
            const cardCount = difficulty === 'easy' ? 8 : 12;
            createGameBoard(cardCount);
            startTimer();
        }

        // 开始游戏按钮事件
        document.getElementById('startBtn').addEventListener('click', () => {
            const nameInput = document.getElementById('studentName');
            studentName = nameInput.value.trim();
            if (!studentName) {
                alert('请输入你的姓名再开始游戏哦！');
                return;
            }
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            document.getElementById('playerName').textContent = studentName;
            initGame('easy');
        });

        // 重新开始/难度切换按钮事件
        document.getElementById('easyBtn').addEventListener('click', () => {
            stopTimer();
            initGame('easy');
        });
        document.getElementById('hardBtn').addEventListener('click', () => {
            stopTimer();
            initGame('hard');
        });
        document.getElementById('resetBtn').addEventListener('click', () => {
            stopTimer();
            const currentCount = document.querySelectorAll('#gameBoard > div').length;
            initGame(currentCount === 8 ? 'easy' : 'hard');
        });
    </script>
</body>
</html>
