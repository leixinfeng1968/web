<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>有理数相反数消消乐（计时竞技版）</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-sky-50 font-sans p-5">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6">
        <h1 class="text-3xl font-bold text-center text-slate-800 mb-1">有理数相反数消消乐</h1>
        <p class="text-center text-slate-500 font-medium mb-6">作者：袁媛</p> <!-- 第二行显示作者信息，位置紧跟标题 -->
        <p class="text-center text-slate-600 mb-6">
            找出<span class="text-red-500 font-bold">互为相反数</span>的卡片，<span class="text-green-600 font-bold">用时越短得分越高</span>，快来挑战！
        </p>
        
        <!-- 学生姓名输入区域 -->
        <div id="loginSection" class="text-center mb-6">
            <input type="text" id="studentName" placeholder="请输入你的姓名" 
                   class="px-4 py-2 border border-slate-300 rounded-lg text-lg w-64 mb-4">
            <button id="startBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-lg font-semibold">开始游戏</button>
        </div>
        
        <!-- 游戏区域（初始隐藏） -->
        <div id="gameArea" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <div class="text-xl font-semibold text-slate-700">
                    玩家：<span id="playerName" class="text-blue-600"></span> | 
                    实时得分：<span id="score" class="text-red-500">0</span> | 
                    用时：<span id="timer" class="text-green-600">00:00</span>
                </div>
                <div class="flex gap-3">
                    <button id="easyBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">简单（8张）</button>
                    <button id="hardBtn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">困难（12张）</button>
                    <button id="resetBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">重新开始</button>
                </div>
            </div>
            
            <div id="gameBoard" class="grid grid-cols-4 gap-4 mb-6"></div>
            
            <div class="bg-blue-50 p-4 rounded-lg text-slate-700">
                <h3 class="font-bold mb-2">游戏规则：</h3>
                <ul class="list-disc pl-5 space-y-1">
                    <li>点击两张卡片，若两数之和为0（互为相反数）则消除（如 5 和 -5、-1/2 和 1/2）</li>
                    <li>计分公式：最终得分 = 基础得分（消除次数×20）× 时间系数（用时越短系数越高）</li>
                    <li>时间系数规则：≤20秒（2.0倍）、21-30秒（1.8倍）、31-40秒（1.5倍）、41-60秒（1.2倍）、＞60秒（1.0倍）</li>
                    <li>0的相反数是0，两张0卡片可相互消除；全部消除后显示最终得分</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 游戏核心数据
        let cardPairs = [];
        let selectedCards = [];
        let baseScore = 0; // 基础得分（消除次数×20）
        let realTimeScore = 0; // 实时得分（基础得分×当前时间系数）
        let isProcessing = false;
        let studentName = '';
        let timerInterval = null;
        let totalSeconds = 0;
        let gameStarted = false; // 游戏是否已开始

        // 生成仅含相反数对的有理数
        function generateNumbers(count) {
            const numbers = [];
            const oppositePairs = [
                { positive: 3, negative: -3 },
                { positive: 2, negative: -2 },
                { positive: 1, negative: -1 },
                { positive: 4, negative: -4 },
                { positive: 5, negative: -5 },
                { positive: 1/2, negative: -1/2 },
                { positive: 1/3, negative: -1/3 },
                { positive: 1/4, negative: -1/4 },
                { positive: 0, negative: 0 }
            ];
            // 确保选择的对数能凑够卡片数量（count必须为偶数）
            const pairCount = count / 2;
            const selectedPairs = [...oppositePairs].sort(() => 0.5 - Math.random()).slice(0, pairCount);
            selectedPairs.forEach(pair => {
                numbers.push({ value: pair.positive, display: formatNumber(pair.positive) });
                numbers.push({ value: pair.negative, display: formatNumber(pair.negative) });
            });
            // 打乱卡片顺序
            return numbers.sort(() => 0.5 - Math.random());
        }

        // 格式化数字显示（分数转字符，避免小数精度问题）
        function formatNumber(num) {
            if (num === 1/2) return "1/2";
            if (num === -1/2) return "-1/2";
            if (num === 1/3) return "1/3";
            if (num === -1/3) return "-1/3";
            if (num === 1/4) return "1/4";
            if (num === -1/4) return "-1/4";
            return num.toString();
        }

        // 检查是否互为相反数（两数之和为0）
        function isMatch(card1, card2) {
            return Math.abs(card1.value + card2.value) < 0.0001; // 兼容浮点数精度问题
        }

        // 创建游戏卡片
        function createGameBoard(count) {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            cardPairs = generateNumbers(count);

            cardPairs.forEach((card, index) => {
                const cardElement = document.createElement('div');
                // 卡片样式：添加过渡动画，确保消失效果流畅
                cardElement.className = 'bg-blue-100 rounded-lg p-6 text-2xl font-bold text-center cursor-pointer hover:bg-blue-200 transition-all duration-400 transform hover:scale-105';
                cardElement.dataset.index = index;
                cardElement.textContent = card.display;
                cardElement.addEventListener('click', () => selectCard(cardElement, card));
                gameBoard.appendChild(cardElement);
            });
        }

        // 计算时间系数
        function getTimeCoefficient(seconds) {
            if (seconds <= 20) return 2.0;
            if (seconds <= 30) return 1.8;
            if (seconds <= 40) return 1.5;
            if (seconds <= 60) return 1.2;
            return 1.0;
        }

        // 实时更新得分（基础得分×当前时间系数）
        function updateRealTimeScore() {
            const coefficient = getTimeCoefficient(totalSeconds);
            realTimeScore = Math.round(baseScore * coefficient);
            document.getElementById('score').textContent = realTimeScore;
        }

        // 开始计时（游戏开始后启动，每秒更新时间和实时得分）
        function startTimer() {
            // 清除原有定时器
            if (timerInterval) clearInterval(timerInterval);
            totalSeconds = 0;
            gameStarted = true;
            timerInterval = setInterval(() => {
                totalSeconds++;
                // 格式化时间为「分:秒」
                const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
                const seconds = (totalSeconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').textContent = `${minutes}:${seconds}`;
                // 实时更新得分
                updateRealTimeScore();
            }, 1000);
        }

        // 停止计时并计算最终得分
        function stopTimer() {
            clearInterval(timerInterval);
            gameStarted = false;
            const finalCoefficient = getTimeCoefficient(totalSeconds);
            const finalScore = Math.round(baseScore * finalCoefficient);
            return { finalScore, finalCoefficient };
        }

        // 选择卡片逻辑
        function selectCard(cardElement, card) {
            // 防止重复点击、连续点击、处理中点击或游戏未开始时点击
            if (!gameStarted || isProcessing || selectedCards.includes(cardElement) || cardElement.classList.contains('matched')) {
                return;
            }

            // 选中效果：背景变黄
            cardElement.classList.remove('bg-blue-100', 'hover:bg-blue-200');
            cardElement.classList.add('bg-yellow-300');
            selectedCards.push({ element: cardElement, data: card });

            // 选中两张卡片时检查匹配
            if (selectedCards.length === 2) {
                isProcessing = true;
                const [cardA, cardB] = selectedCards;

                if (isMatch(cardA.data, cardB.data)) {
                    // 匹配成功：卡片完全消失 + 累加基础得分
                    setTimeout(() => {
                        // 卡片消失效果：透明度→0，高度→0，消除占位
                        cardA.element.classList.add('matched');
                        cardB.element.classList.add('matched');
                        cardA.element.style.opacity = '0';
                        cardA.element.style.height = '0';
                        cardA.element.style.padding = '0';
                        cardA.element.style.margin = '0';
                        cardA.element.style.border = 'none';
                        
                        cardB.element.style.opacity = '0';
                        cardB.element.style.height = '0';
                        cardB.element.style.padding = '0';
                        cardB.element.style.margin = '0';
                        cardB.element.style.border = 'none';
                        
                        // 禁止再次点击已消除的卡片
                        cardA.element.style.pointerEvents = 'none';
                        cardB.element.style.pointerEvents = 'none';
                        
                        // 累加基础得分（每次消除得20分）
                        baseScore += 20;
                        // 更新实时得分
                        updateRealTimeScore();
                        
                        // 重置选中状态
                        selectedCards = [];
                        isProcessing = false;

                        // 检查游戏是否胜利（所有卡片都被消除）
                        if (document.querySelectorAll('.matched').length === cardPairs.length) {
                            const { finalScore, finalCoefficient } = stopTimer();
                            // 显示最终结果弹窗
                            setTimeout(() => {
                                alert(`恭喜 ${studentName} 挑战成功！\n总用时：${document.getElementById('timer').textContent}\n基础得分：${baseScore}分\n时间系数：${finalCoefficient}倍\n最终得分：${finalScore}分\n?? 用时越短，系数越高，得分翻倍！`);
                            }, 500);
                        }
                    }, 400); // 与卡片过渡动画时长一致
                } else {
                    // 匹配失败：恢复卡片原状
                    setTimeout(() => {
                        cardA.element.classList.remove('bg-yellow-300');
                        cardB.element.classList.remove('bg-yellow-300');
                        cardA.element.classList.add('bg-blue-100', 'hover:bg-blue-200');
                        cardB.element.classList.add('bg-blue-100', 'hover:bg-blue-200');
                        
                        selectedCards = [];
                        isProcessing = false;
                    }, 800);
                }
            }
        }

        // 初始化游戏
        function initGame(difficulty) {
            baseScore = 0;
            realTimeScore = 0;
            selectedCards = [];
            document.getElementById('score').textContent = realTimeScore;
            const cardCount = difficulty === 'easy' ? 8 : 12;
            createGameBoard(cardCount);
            startTimer();
        }

        // 开始游戏按钮事件
        document.getElementById('startBtn').addEventListener('click', () => {
            const nameInput = document.getElementById('studentName');
            studentName = nameInput.value.trim();
            if (!studentName) {
                alert('请输入你的姓名再开始游戏哦！');
                return;
            }
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('gameArea').classList.remove('hidden');
            document.getElementById('playerName').textContent = studentName;
            initGame('easy'); // 默认加载简单难度
        });

        // 重新开始/难度切换按钮事件
        document.getElementById('easyBtn').addEventListener('click', () => {
            stopTimer();
            initGame('easy');
        });
        document.getElementById('hardBtn').addEventListener('click', () => {
            stopTimer();
            initGame('hard');
        });
        document.getElementById('resetBtn').addEventListener('click', () => {
            stopTimer();
            const currentCount = document.querySelectorAll('#gameBoard > div').length;
            initGame(currentCount === 8 ? 'easy' : 'hard');
        });
    </script>
</body>
</html>
